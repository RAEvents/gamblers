var S="https://retroachievements.org/API",C=(e,t,a,n={})=>{let i=`${e}/${t}`.replaceAll(/([^:]\/)\/+/g,"$1"),r={z:a.username,y:a.webApiKey};for(let[o,s]of Object.entries(n))i.includes(`:${o}`)?i=i.replace(`:${o}`,String(s)):s!==void 0&&(r[o]=String(s));return`${i}?${new URLSearchParams(r).toString()}`},G=async e=>{let{url:t}=e,a=new Headers({"User-Agent":"RetroAchievements-api-js/2.1.0"}),n=await fetch(t,typeof window!==void 0?{}:{headers:a});if(!n.ok)throw new Error(`HTTP Error: Status ${n.status} ${n.statusText}`);return await n.json()};function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},m.apply(this,arguments)}var p=(e,t={})=>{let{shouldCastToNumbers:a,shouldMapToBooleans:n}=t,i=e;if(Array.isArray(e)){let r=[];for(let o of e)r.push(p(o,t));i=r}else if(!Array.isArray(e)&&e instanceof Object){let r={};for(let[o,s]of Object.entries(e)){let c=s;a!=null&&a.includes(o)&&(c=s===null?null:Number(s)),n!=null&&n.includes(o)&&(c=s===null?null:String(s)==="1"),r=m({},r,{[U(o)]:p(c,t)})}i=r}return i},U=e=>{if(e.toUpperCase()===e)return e.toLowerCase();let t=e.charAt(0).toLowerCase()+e.slice(1);return t=t.replaceAll("ID","Id"),t=t.replaceAll("URL","Url"),t=t.replaceAll("rA","ra"),t=t.replaceAll("visibleUserawards","visibleUserAwards"),t},d=async(e,t)=>{let{achievementId:a,offset:n,count:i}=t,r={a};n&&(r.o=n),i&&(r.c=i);let o=C(S,"/API_GetAchievementUnlocks.php",e,r),s=await G({url:o});return p(s,{shouldCastToNumbers:["ID","Points","TrueRatio","RAPoints","RASoftcorePoints"],shouldMapToBooleans:["HardcoreMode"]})};var y,v,b;(function(e){e[e.NewSet=0]="NewSet",e[e.Revision=1]="Revision"})(y||(y={})),function(e){e[e.Active=0]="Active",e[e.Complete=1]="Complete",e[e.Dropped=2]="Dropped"}(v||(v={})),function(e){e[e.Primary=0]="Primary",e[e.Collaboration=1]="Collaboration"}(b||(b={}));var A,w;(function(e){e[e.CoreAchievements=3]="CoreAchievements",e[e.UnofficialAchievements=5]="UnofficialAchievements"})(A||(A={})),function(e){e.Primary="0",e.Collaboration="1"}(w||(w={}));var h=e=>{if(!e.username||!e.webApiKey)throw new Error(`
      buildAuthorization() requires an object containing a
      username and webApiKey. eg:

      const authorization = buildAuthorization({
        username: "myUserName",
        webApiKey: "myWebApiKey"
      })
    `);return e};var D=e=>new Promise(t=>setTimeout(()=>t(),e)),N=200;var I=0;async function g(){await D(N*Math.pow(2,I))}function P(){I=0}function T(e,...t){let a="";for(let[n,i]of e.entries())a+=i,n in t&&(a+=t[n]);return a}function x(e){let t=document.createElement("div");t.id="toast",t.innerText=e,document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)}async function R(){if(localStorage.getItem("auth")){let e=JSON.parse(localStorage.getItem("auth"));"apikey"in e&&(e.webApiKey=e.apikey,delete e.apikey,localStorage.setItem("auth",JSON.stringify(e)));let t=h(e);return t.toString=function(){return`z=${this.username}&y=${this.webApiKey}`},t}else return await $()}function $(){let t=document.getElementById("authModalTemplate").content.cloneNode(!0),a=t.children[0].querySelector("button");return document.body.appendChild(t),new Promise(n=>{a.addEventListener("click",i=>{let r=document.querySelector("div.authModal"),o={username:r.querySelector("input[name='username']").value,webApiKey:r.querySelector("input[name='apikey']").value};r.querySelector("input[name='saveinfo']").checked&&localStorage.setItem("auth",JSON.stringify(o)),document.body.removeChild(r),n(h(o))})})}document.getElementById("verify").addEventListener("click",async()=>{let e=await R();P(),f("output");let t=document.getElementById("output");t.innerHTML=T`<h1>Gamblers</h1><span class="copy">ðŸ“‹</span><hr /><span class="spinner"></span>`,t.querySelector("h1 ~ span.copy").addEventListener("click",()=>{navigator.clipboard.writeText(Array.from(t.querySelectorAll(".user > a")).map(o=>o.innerText).join(`
`)),x("Full list copied to clipboard")});let a=t.querySelector(".spinner"),n=[],i=document.getElementById("achievements"),r=Array.from(i.querySelectorAll("input[type='text']")).map(o=>o.value).map(o=>Array.from(o.matchAll("https://(?:www.)?retroachievements.org/achievement/([0-9]+)"))).flatMap(o=>o.map(([s,c])=>c));for(let o of r){let s=await d(e,{achievementId:o,count:500,offset:0});await g();let c=s.unlocksCount-500,l=s.unlocks;for(;c>0;){let u=await d(e,{achievementId:o,count:500,offset:l.length});await g(),l.push(...u.unlocks),c-=500}n.length==0?n.push(...l.map(u=>u.user)):n=n.filter(u=>l.map(k=>k.user).includes(u))}for(let o of n){let s=document.createElement("div");s.className="user",s.innerHTML=T`<a href=${`https://retroachievements.org/user/${o}`}>${o}</a><span class="copy">ðŸ“‹</span>`,s.querySelector("span.copy").addEventListener("click",()=>{navigator.clipboard.writeText(o),x("Username copied to clipboard")}),a.parentElement.append(s)}a.remove()});document.getElementById("clear").addEventListener("click",()=>{document.getElementById("users").value="",document.getElementById("output").innerHTML="",f("submission")});document.getElementById("resetAuth").addEventListener("click",()=>{localStorage.removeItem("auth")});for(let e of document.querySelectorAll("#tabs > div")){let t=e.dataset.target;e.addEventListener("mousedown",()=>{f(t)})}function f(e){document.getElementById(e).style.display="block";for(let t of document.querySelectorAll(`#content > :not(#${e})`))t.style.display="none";for(let t of document.querySelectorAll("#tabs > div"))t.classList.remove("selected"),t.dataset.target==e&&t.classList.add("selected")}
//# sourceMappingURL=app.js.map
