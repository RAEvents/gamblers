var k="https://retroachievements.org/API",S=(e,t,a,o={})=>{let i=`${e}/${t}`.replaceAll(/([^:]\/)\/+/g,"$1"),r={z:a.username,y:a.webApiKey};for(let[n,s]of Object.entries(o))i.includes(`:${n}`)?i=i.replace(`:${n}`,String(s)):s!==void 0&&(r[n]=String(s));return`${i}?${new URLSearchParams(r).toString()}`},C=async e=>{let{url:t}=e,a=new Headers({"User-Agent":"RetroAchievements-api-js/2.1.0"}),o=await fetch(t,typeof window!==void 0?{}:{headers:a});if(!o.ok)throw new Error(`HTTP Error: Status ${o.status} ${o.statusText}`);return await o.json()};function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},m.apply(this,arguments)}var p=(e,t={})=>{let{shouldCastToNumbers:a,shouldMapToBooleans:o}=t,i=e;if(Array.isArray(e)){let r=[];for(let n of e)r.push(p(n,t));i=r}else if(!Array.isArray(e)&&e instanceof Object){let r={};for(let[n,s]of Object.entries(e)){let c=s;a!=null&&a.includes(n)&&(c=s===null?null:Number(s)),o!=null&&o.includes(n)&&(c=s===null?null:String(s)==="1"),r=m({},r,{[G(n)]:p(c,t)})}i=r}return i},G=e=>{if(e.toUpperCase()===e)return e.toLowerCase();let t=e.charAt(0).toLowerCase()+e.slice(1);return t=t.replaceAll("ID","Id"),t=t.replaceAll("URL","Url"),t=t.replaceAll("rA","ra"),t=t.replaceAll("visibleUserawards","visibleUserAwards"),t},d=async(e,t)=>{let{achievementId:a,offset:o,count:i}=t,r={a};o&&(r.o=o),i&&(r.c=i);let n=S(k,"/API_GetAchievementUnlocks.php",e,r),s=await C({url:n});return p(s,{shouldCastToNumbers:["ID","Points","TrueRatio","RAPoints","RASoftcorePoints"],shouldMapToBooleans:["HardcoreMode"]})};var y,v,b;(function(e){e[e.NewSet=0]="NewSet",e[e.Revision=1]="Revision"})(y||(y={})),function(e){e[e.Active=0]="Active",e[e.Complete=1]="Complete",e[e.Dropped=2]="Dropped"}(v||(v={})),function(e){e[e.Primary=0]="Primary",e[e.Collaboration=1]="Collaboration"}(b||(b={}));var A,w;(function(e){e[e.CoreAchievements=3]="CoreAchievements",e[e.UnofficialAchievements=5]="UnofficialAchievements"})(A||(A={})),function(e){e.Primary="0",e.Collaboration="1"}(w||(w={}));var h=e=>{if(!e.username||!e.webApiKey)throw new Error(`
      buildAuthorization() requires an object containing a
      username and webApiKey. eg:

      const authorization = buildAuthorization({
        username: "myUserName",
        webApiKey: "myWebApiKey"
      })
    `);return e};var U=e=>new Promise(t=>setTimeout(()=>t(),e)),D=200;var I=0;async function g(){await U(D*Math.pow(2,I))}function P(){I=0}function T(e,...t){let a="";for(let[o,i]of e.entries())a+=i,o in t&&(a+=t[o]);return a}function M(e){let t=document.createElement("div");t.id="toast",t.innerText=e,document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)}async function R(){if(localStorage.getItem("auth")){let e=JSON.parse(localStorage.getItem("auth"));"apikey"in e&&(e.webApiKey=e.apikey,delete e.apikey,localStorage.setItem("auth",JSON.stringify(e)));let t=h(e);return t.toString=function(){return`z=${this.username}&y=${this.webApiKey}`},t}else return await $()}function $(){let t=document.getElementById("authModalTemplate").content.cloneNode(!0),a=t.children[0].querySelector("button");return document.body.appendChild(t),new Promise(o=>{a.addEventListener("click",i=>{let r=document.querySelector("div.authModal"),n={username:r.querySelector("input[name='username']").value,webApiKey:r.querySelector("input[name='apikey']").value};r.querySelector("input[name='saveinfo']").checked&&localStorage.setItem("auth",JSON.stringify(n)),document.body.removeChild(r),o(h(n))})})}document.getElementById("verify").addEventListener("click",async()=>{let e=await R();P(),f("output");let t=document.getElementById("output");t.innerHTML=T`<h1>Gamblers</h1><hr /><span class="spinner"></span>`;let a=t.querySelector(".spinner"),o=[],i=document.getElementById("achievements"),r=Array.from(i.querySelectorAll("input[type='text']")).map(n=>n.value).map(n=>Array.from(n.matchAll("https://(?:www.)?retroachievements.org/achievement/([0-9]+)"))).flatMap(n=>n.map(([s,c])=>c));for(let n of r){let s=await d(e,{achievementId:n,count:500,offset:0});await g();let c=s.unlocksCount-500,l=s.unlocks;for(;c>0;){let u=await d(e,{achievementId:n,count:500,offset:l.length});await g(),l.push(...u.unlocks),c-=500}o.length==0?o.push(...l.map(u=>u.user)):o=o.filter(u=>l.map(x=>x.user).includes(u))}for(let n of o){let s=document.createElement("div");s.className="user",s.innerHTML=T`<a href=${`https://retroachievements.org/user/${n}`}>${n}</a><span class="copy">ðŸ“‹</span>`,s.querySelector("span.copy").addEventListener("click",()=>{navigator.clipboard.writeText(n),M("Username copied to clipboard")}),a.parentElement.append(s)}a.remove()});document.getElementById("clear").addEventListener("click",()=>{document.getElementById("users").value="",document.getElementById("output").innerHTML="",f("submission")});document.getElementById("resetAuth").addEventListener("click",()=>{localStorage.removeItem("auth")});for(let e of document.querySelectorAll("#tabs > div")){let t=e.dataset.target;e.addEventListener("mousedown",()=>{f(t)})}function f(e){document.getElementById(e).style.display="block";for(let t of document.querySelectorAll(`#content > :not(#${e})`))t.style.display="none";for(let t of document.querySelectorAll("#tabs > div"))t.classList.remove("selected"),t.dataset.target==e&&t.classList.add("selected")}
//# sourceMappingURL=app.js.map
